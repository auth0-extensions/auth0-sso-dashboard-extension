module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=0)}([function(e,t,n){"use strict";var r=n(1),o=n(2),s=n(3),i=n(10),a=n(23),u=n(35);o.urlHelpers.getBaseUrl=function(e){var t=r.parse(e.originalUrl||"").pathname||"";return r.format({protocol:"https",host:e.headers.host,pathname:t.replace(e.path,"").replace(/\/$/g,"")})};var c=o.createServer(function(e,t){return a.info("Starting SSO Dashboard Extension - Version:","2.0.0"),s(e,t)});e.exports=function(e,t,n){i.setValue("PUBLIC_WT_URL",u.getUrl(t)),c(e,t,n)}},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("auth0-extension-express-tools")},function(e,t,n){"use strict";(function(t){var r=n(4),o=n(5),s=n(6),i=n(7),a=n(8),u=n(2),c=u.middlewares,l=u.routes,p=n(9),d=n(29),h=n(31),f=n(23),g=n(10),m=n(32);e.exports=function(e,n){g.setProvider(e);var u=n?new a.WebtaskStorageContext(n,{force:1}):new a.FileStorageContext(r.join(t,"./data.json"),{mergeWrites:!0}),v=new s;return v.use(o(":method :url :status :response-time ms - :res[content-length]",{stream:f.stream})),v.use(i.json()),v.use(i.urlencoded({extended:!1})),v.use(l.dashboardAdmins({secret:g("EXTENSION_SECRET"),audience:"urn:sso-dashboard",rta:g("AUTH0_RTA").replace("https://",""),domain:g("AUTH0_DOMAIN"),baseUrl:g("PUBLIC_WT_URL"),clientName:"SSO Dashboard",urlPrefix:"/admins",sessionStorageKey:"sso-dashboard:apiToken",scopes:"read:clients delete:clients read:connections read:resource_servers create:resource_servers read:client_grants create:client_grants delete:client_grants"})),v.use("/api",p(u)),v.use("/app",s.static(r.join(t,"../dist"))),v.use("/meta",d()),v.use("/.extensions",h()),v.get("*",m()),v.use(c.errorHandler(f.error)),v}}).call(this,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("auth0-extension-tools")},function(e,t,n){"use strict";var r=n(6).Router,o=n(8).ForbiddenError,s=n(2).middlewares,i=n(10),a=n(11),u=n(15),c=n(26),l=n(27);e.exports=function(e){var t=r();t.use(s.authenticateUsers.optional({domain:i("AUTH0_DOMAIN"),audience:i("API_AUDIENCE")||"urn:auth0-sso-dashboard",credentialsRequired:!1,onLoginSuccess:function(e,t,n){return e.user.scope&&e.user.scope.indexOf("manage:applications")>-1&&!e.user.sub.endsWith("@client")?n(new o('"manage:applications" scope is not allowed for endusers.')):n()}})),t.use(s.authenticateAdmins.optional({credentialsRequired:!1,secret:i("EXTENSION_SECRET"),audience:"urn:sso-dashboard",baseUrl:i("PUBLIC_WT_URL"),onLoginSuccess:function(e,t,n){e.user.scope=["read:applications","manage:applications","manage:authorization"],n()}}));var n=s.managementApiClient({domain:i("AUTH0_DOMAIN")});return t.use("/applications",u(n,e)),t.use("/groups",c(e)),t.use("/authorization",l(e)),t.use("/connections",a(n)),t.get("/status",function(e,t){t.json({isAdmin:e.user.scope&&e.user.scope.indexOf("manage:applications")>-1})}),t}},function(e,t,n){"use strict";var r={},o=null,s=function(e){if(r&&r[e])return r[e];if(!o)throw new Error("A configuration provider has not been set");return o(e)};s.setProvider=function(e){o=e},s.setValue=function(e,t){r[e]=t},e.exports=s},function(e,t,n){"use strict";var r=n(12),o=n(6).Router,s=n(13).requireScope;e.exports=function(e){var t=o();return t.get("/",e,s("manage:applications"),function(e,t,n){e.auth0.connections.getAll({fields:"name"}).then(function(e){return r.chain(e).sortBy(function(e){return e.name.toLowerCase()}).value()}).then(function(e){return t.json(e)}).catch(n)}),t}},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var r=n(14);e.exports={requireScope:r}},function(e,t,n){"use strict";var r=n(8).ForbiddenError;e.exports=function(e){return function(t,n,o){return!t.user||!t.user.scope||t.user.scope.indexOf(e)<0?o(new r(`Cannot perform action. Missing scope ${e}`)):o()}}},function(e,t,n){"use strict";var r=n(12),o=n(16),s=n(6).Router,i=n(10),a=n(13).requireScope,u=n(17),c=u.saveApplication,l=u.deleteApplication,p=n(20).getGroupsForUser,d=n(25).hasGroup;e.exports=function(e,t){var n=s();return n.get("/clients",e,a("manage:applications"),function(e,t,n){e.auth0.clients.getAll({fields:"client_id,name,callbacks,global,app_type"}).then(function(e){return r.chain(e).filter(function(e){return!e.global}).sortBy(function(e){return e.name.toLowerCase()}).value()}).then(function(e){return t.json(e)}).catch(n)}),n.get("/",a("read:applications"),function(e,n,r){var o;t.read().then(function(e){return o=e.applications||{},null}).then(function(){return t.read()}).then(function(t){return i("ALLOW_AUTHZ")&&t.authorizationEnabled?p(e.user.sub):null}).then(function(e){var t={};return Object.keys(o).map(function(n){var r=o[n];return r.enabled&&r.loginUrl&&d(e,r.groups)&&(t[n]=r),r}),t}).then(function(e){return n.json(e)}).catch(r)}),n.get("/all",a("manage:applications"),function(e,n,r){t.read().then(function(e){return n.json(e.applications||{})}).catch(r)}),n.get("/:id",a("manage:applications"),function(e,n,r){t.read().then(function(t){return n.json({application:t.applications[e.params.id]})}).catch(r)}),n.put("/:id",a("manage:applications"),function(e,n,r){c(e.params.id,e.body,t).then(function(){return n.status(204).send()}).catch(r)}),n.post("/",a("manage:applications"),function(e,n,r){var s=o.v4();c(s,e.body,t).then(function(){return n.status(201).send({id:s})}).catch(r)}),n.delete("/:id",a("manage:applications"),function(e,n,r){l(e.params.id,t).then(function(){return n.status(204).send()}).catch(r)}),n}},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";var r=n(18),o=n(19);e.exports={saveApplication:function(e,t,n){return new r(function(r,s){var i={name:t.name,client:t.client,enabled:t.enabled,type:t.type,logo:t.logo,connection:t.connection,groups:Array.isArray(t.groups)?t.groups:[t.groups],callback:t.callback,customURL:t.customURL,customURLEnabled:t.customURLEnabled};"oidc"===t.type&&(i.response_type=t.response_type||"code",i.scope=t.scope||"openid"),i.loginUrl=o(i),n.read().then(function(t){return(t=t||{}).applications=t.applications||{},t.applications[e]=i,n.write(t).then(r).catch(s)}).catch(s)})},deleteApplication:function(e,t){return new r(function(n,r){t.read().then(function(o){return o.applications[e]=null,delete o.applications[e],t.write(o).then(n).catch(r)}).catch(r)})}}},function(e,t){e.exports=require("bluebird")},function(e,t,n){"use strict";var r=n(10);e.exports=function(e){var t=e.type,n=e.callback||"",o=r("AUTH0_DOMAIN"),s=e.client,i=e.response_type||"code",a=e.scope||"openid",u="";switch(t){case"saml":u=`https://${o}/samlp/${s}`;break;case"wsfed":u=`https://${o}/wsfed/${s}?wreply=${n}`;break;default:case"oidc":u=`https://${o}/authorize?response_type=${i}&scope=${a}&client_id=${s}&redirect_uri=${encodeURIComponent(n)}`}return e.connection&&(u.indexOf("?")>0?u+="wsfed"===t?"&whr=":"&connection=":u+="wsfed"===t?"?whr=":"?connection=",u+=e.connection),u}},function(e,t,n){"use strict";var r=n(12),o=n(18),s=n(21),i=n(22),a=n(8),u=a.managementApi,c=a.ValidationError,l=n(10),p=n(23),d=function(){if(l("AUTHZ_API_DEV_URL"))return l("AUTHZ_API_DEV_URL");var e=l("PUBLIC_WT_URL");"/"===e[e.length-1]&&(e[e.length-1]="");var t=e.split("/");return t[t.length-1]="adf6e2f2b84784b57522e3b19dfc9201/api",t.join("/")},h=o.promisify(i({load:function(e){new o(function(e,t){var n={client_id:l("AUTH0_CLIENT_ID"),client_secret:l("AUTH0_CLIENT_SECRET"),audience:"urn:auth0-authz-api",grant_type:"client_credentials"};s("POST",`https://${l("AUTH0_DOMAIN")}/oauth/token`).send(n).set("Content-Type","application/json").end(function(n,r){return!n&&r.body&&r.body.access_token?e(r.body.access_token):(p.error(r.body),t(n))})}).then(function(t){return e(null,t)}).catch(function(t){return e(t)})},hash:function(){return"auth0-authz-apiToken"},max:100,maxAge:36e5})),f=function(e,t,n,r){return new o(function(i,a){return function(e){return e.user&&e.user.access_token&&e.user.access_token.length?o.resolve(e.user.access_token):u.getAccessTokenCached(l("AUTH0_DOMAIN"),l("AUTH0_CLIENT_ID"),l("AUTH0_CLIENT_SECRET"))}(e).then(function(e){s(n,`https://${l("AUTH0_DOMAIN")}/api/v2/${t}`).send(r||{}).set("Content-Type","application/json").set("Authorization",`Bearer ${e}`).end(function(e,t){return e?(p.error(t.body),a(e)):i(t.body)})})})},g=function(e,t){return f(e,"resource-servers","GET").then(function(e){var n=e.filter(function(e){return e.identifier===t});return n.length&&n[0]})};e.exports={getGroups:function(){return new o(function(e,t){h().then(function(n){return n?s("GET",`${d()}/groups`).set("Content-Type","application/json").set("Authorization",`Bearer ${n}`).end(function(n,r){return n?(p.error(r.body),t(n)):e(r.body.groups||[])}):e(null)}).catch(t)})},getGroupsForUser:function(e){return new o(function(t,n){h().then(function(o){return o?e?s("GET",`${d()}/users/${e}/groups/calculate`).set("Content-Type","application/json").set("Authorization",`Bearer ${o}`).end(function(e,o){if(e)return p.error(o.body),n(e);var s=r.map(o.body||[],function(e){return e._id});return t(s)}):n(new c("User ID is required.")):t(null)}).catch(n)})},getResourceServer:g,createResourceServer:function(e){var t={name:l("API_NAME")||"SSO Dashboard API",identifier:l("API_AUDIENCE")||"urn:auth0-sso-dashboard",signing_alg:"RS256",scopes:[{value:"read:applications",description:"Get applications"},{value:"manage:applications",description:"Manage applications"}],token_lifetime:86400};return f(e,"resource-servers","POST",t)},deleteResourceServer:function(e){return g(e,"urn:auth0-sso-dashboard").then(function(t){return t.id?f(e,`resource-servers/${t.id}`,"DELETE"):o.resolve()})},addGrant:function(e){return f(e,"client-grants","POST",{client_id:l("AUTH0_CLIENT_ID"),audience:"urn:auth0-authz-api",scope:["read:users","read:groups"]})},removeGrant:function(e){return function(e){return f(e,"client-grants","GET").then(function(e){return e.filter(function(e){return e.client_id===l("AUTH0_CLIENT_ID")&&"urn:auth0-authz-api"===e.audience})}).then(function(e){return e[0]&&e[0].id})}(e).then(function(t){return t?f(e,`client-grants/${t}`,"DELETE"):o.resolve()})}}},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("lru-memoizer")},function(e,t,n){"use strict";var r=n(24);r.emitErrs=!0;var o=new r.Logger({transports:[new r.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=o,e.exports.stream={write:function(e){o.info(e.replace(/\n$/,""))}}},function(e,t){e.exports=require("winston")},function(e,t,n){"use strict";var r=n(12);e.exports={hasGroup:function(e,t){if(!e||!t||!t.length)return!0;var n=r.intersection(e,t);return n&&n.length>=1}}},function(e,t,n){"use strict";var r=n(6).Router,o=n(10),s=n(20).getGroups,i=n(13).requireScope;e.exports=function(e){var t=r();return t.get("/",i("manage:applications"),function(t,n,r){return o("ALLOW_AUTHZ")?e.read().then(function(e){return e.authorizationEnabled?s(t.params.appId).then(function(e){return n.json(e)}):n.json([])}).catch(r):n.json([])}),t}},function(e,t,n){"use strict";var r=n(6).Router,o=n(10),s=n(28),i=n(13).requireScope;e.exports=function(e){var t=r();return t.get("/",i("manage:authorization"),function(t,n,r){return o("ALLOW_AUTHZ")?s.getStatus(t,e).then(function(e){return n.json(e)}).catch(r):n.json({authorizationApiAvailable:!1})}),t.post("/",i("manage:authorization"),function(t,n,r){return o("ALLOW_AUTHZ")?s.enable(t,e).then(function(){return n.json({enabled:!0})}).catch(r):r()}),t.delete("/",i("manage:authorization"),function(t,n,r){return o("ALLOW_AUTHZ")?s.disable(t,e).then(function(){return n.json({enabled:!1})}).catch(r):r()}),t}},function(e,t,n){"use strict";var r=n(18),o=n(8).ValidationError,s=n(20),i=s.addGrant,a=s.removeGrant,u=s.getResourceServer;e.exports={getStatus:function(e,t){return t.read().then(function(t){var n={authorizationEnabled:t.authorizationEnabled};return u(e,"urn:auth0-authz-api").then(function(e){return n.authorizationApiAvailable=!!e,n})})},enable:function(e,t){return t.read().then(function(n){return n.authorizationEnabled?r.resolve():u(e,"urn:auth0-authz-api").then(function(s){if(!s){var a=new o("Authorization API not found.");return a.status=400,r.reject(a)}return i(e).then(function(){return n.authorizationEnabled=!0,t.write(n)})})})},disable:function(e,t){return t.read().then(function(n){return n.authorizationEnabled?a(e).then(function(){return n.authorizationEnabled=!1,t.write(n)}):r.resolve()})}}},function(e,t,n){"use strict";var r=n(6),o=n(30);e.exports=function(){var e=r.Router();return e.get("/",function(e,t){t.status(200).send(o)}),e}},function(e){e.exports={title:"SSO Dashboard",name:"kusold-sso-dashboard",version:"2.0.0",author:"Kusold",useHashName:!1,description:"This extension provides your users with a dashboard for all of their applications.",type:"application",logoUrl:"https://cdn.auth0.com/extensions/auth0-sso-dashboard/assets/logo.svg",initialUrlPath:"/admins/login",repository:"https://github.com/kusold/auth0-sso-dashboard-extension",keywords:["auth0","extension"],auth0:{createClient:!0,onUninstallPath:"/.extensions/on-uninstall",onInstallPath:"/.extensions/on-install",onUpdatePath:"/.extensions/on-update",scopes:"read:clients delete:clients read:connections read:resource_servers create:resource_servers read:client_grants create:client_grants delete:client_grants"},secrets:{EXTENSION_CLIENT_ID:{description:"Client ID of the application you created in the Auth0 Management Dashboard",required:!0},TITLE:{description:"Custom title for the dashboard",example:"Fabrikam SSO Dashboard",required:!1},CUSTOM_CSS:{description:"A CSS file containing custom styles for the extension",example:"https://cdn.fabrikam.com/static/extensions/theme/fabrikam.css",required:!1}}}},function(e,t,n){"use strict";var r=n(6).Router,o=n(2).middlewares,s=n(10),i=n(23),a=n(20),u=a.getResourceServer,c=a.createResourceServer,l=a.deleteResourceServer;e.exports=function(){var e=r(),t=o.validateHookToken(s("AUTH0_DOMAIN"),s("WT_URL"),s("EXTENSION_SECRET"));return e.use("/on-install",t("/.extensions/on-install")),e.use("/on-update",t("/.extensions/on-update")),e.use("/on-uninstall",t("/.extensions/on-uninstall")),e.use(o.managementApiClient({domain:s("AUTH0_DOMAIN"),clientId:s("AUTH0_CLIENT_ID"),clientSecret:s("AUTH0_CLIENT_SECRET")})),e.post("/on-install",function(e,t){u(e,"urn:auth0-sso-dashboard").then(function(t){return t?Promise.resolve():c(e)}).then(function(){i.debug("Resource server for the SSO Dashboard extension created.")}).then(function(){t.sendStatus(204)}).catch(function(e){i.debug("Error deploying resources for the SSO Dashboard extension."),i.error(e),t.sendStatus(400)})}),e.put("/on-update",function(e,t){u(e,"urn:auth0-sso-dashboard").then(function(t){return t?Promise.resolve():c(e)}).then(function(){i.debug("Resource server for the SSO Dashboard extension created.")}).then(function(){t.sendStatus(204)}).catch(function(e){i.debug("Error deploying resources for the SSO Dashboard extension."),i.error(e),t.sendStatus(400)})}),e.delete("/on-uninstall",function(e,t){var n=s("AUTH0_CLIENT_ID");l(e).then(function(){return e.auth0.clients.delete({client_id:n})}).then(function(){i.debug(`Deleted client ${n}`),t.sendStatus(204)}).catch(function(e){i.debug(`Error deleting client: ${s("AUTH0_CLIENT_ID")}`),i.error(e),t.sendStatus(204)})}),e}},function(e,t,n){"use strict";(function(t){n(33);var r=n(34),o=(n(4),n(2).urlHelpers),s=n(10);e.exports=function(){var e="//cdn.auth0.com/extensions/develop/kusold-sso-dashboard/assets",t=`\n  <!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <title><%= config.TITLE %></title>\n    <meta charset="UTF-8" />\n    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/4.6.13/lib/logos/img/favicon.png">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.1672/css/index.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/4.6.13/index.min.css" />\n    <% if (assets.style) { %><link rel="stylesheet" type="text/css" href="/app/<%= assets.style %>" /><% } %>\n    <% if (assets.version) { %><link rel="stylesheet" type="text/css" href="${e}/kusold-sso-dashboard.ui.<%= assets.version %>.css" /><% } %>\n    <% if (assets.customCss) { %><link rel="stylesheet" type="text/css" href="<%= assets.customCss %>" /><% } %>\n  </head>\n  <body>\n    <div id="app"></div>\n    <script type="text/javascript" src="//cdn.auth0.com/js/auth0/8.6/auth0.min.js"><\/script>\n    <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.1672/js/bundle.js"><\/script>\n    <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;<\/script>\n    <% if (assets.vendors) { %><script type="text/javascript" src="<%= assets.vendors %>"><\/script><% } %>\n    <% if (assets.app) { %><script type="text/javascript" src="<%= assets.app %>"><\/script><% } %>\n    <% if (assets.version) { %>\n    <script type="text/javascript" src="${e}/kusold-sso-dashboard.ui.vendor.<%= assets.version %>.js"><\/script>\n    <script type="text/javascript" src="${e}/kusold-sso-dashboard.ui.<%= assets.version %>.js"><\/script>\n    <% } %>\n  </body>\n  </html>\n  `;return function(e,n,i){if(0===e.url.indexOf("/api"))return i();var a={AUTH0_DOMAIN:s("AUTH0_DOMAIN"),AUTH0_CLIENT_ID:s("EXTENSION_CLIENT_ID"),AUTH0_MANAGE_URL:s("AUTH0_MANAGE_URL")||"https://manage.auth0.com",ALLOW_AUTHZ:s("ALLOW_AUTHZ"),BASE_URL:o.getBaseUrl(e),BASE_PATH:o.getBasePath(e),TITLE:s("TITLE"),API_AUDIENCE:"urn:auth0-sso-dashboard"};return console.log("production"),console.log("LOADING FROM CDN"),n.send(r.render(t,{config:a,assets:{customCss:s("CUSTOM_CSS"),version:"2.0.0"}}))}}}).call(this,"/")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("ejs")},function(e,t,n){"use strict";var r=n(1),o=3,s=2,i=1,a=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports.getUrl=function(e){var t=function(e){if(!e.container)return null;var t=e.container.replace(a,"\\$&"),n=e.jtn?e.jtn.replace(a,"\\$&"):"";if(e.url_format===i)return new RegExp(`^/api/run/${t}/(?:${n}/?)?`);if(e.url_format===s)return new RegExp(`^/${t}/(?:${n}/?)?`);if(e.url_format===o)return new RegExp(`^/(?:${n}/?)?`);throw new Error("Unsupported webtask URL format.")}(e.x_wt),n=e.url,u=e.url.replace(t,"/"),c=r.parse(u||"").pathname,l=r.parse(n||"").pathname||"";return r.format({protocol:"https",host:e.headers.host,pathname:l.replace(c,"").replace(/\/$/g,"")})}}]);